
      SUBROUTINE DOT310(IGOTO,INFO,NDV,NCON,OBJ,G,NGT,IC,DF,
     1A,X,WK,IWK,ICSLP,XL,XU,S,IPRINT,SCALX,ISIDC,ITMP,NRB,
     2NAC,NVC,XLSLP,XUSLP,RPRM,IPRM,IPOINT,NGMAX,MINMAX,ASLP,
     3DG,XZRO,GZRO,C,HM,GMULT,ALAMDA,P,GGL,ALP1,ALP2,ALPBST,ALPHA,
     4GMAX,GMAX1,GMAXZ,ICHK,IDEL,IDAB,JTER,NAVCQ,OBJ1,OBJ2,OBJSAV,
     5PHI1,PHIZ,SLOPF,NACS,GSAV,NAVCR)
C
C                 ***** (C) COPYRIGHT *****
C     ***** VANDERPLAATS RESEARCH & DEVELOPMENT, INC. *****
C         ***** ALL RIGHTS RESERVED, WORLDWIDE *****
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION G(*),IC(*),DF(*),A(NDV,*),X(*),WK(*),IWK(*),
     1ICSLP(*),XL(*),XU(*),S(*),SCALX(*),ISIDC(*),ITMP(*),XLSLP(*),
     2XUSLP(*),RPRM(*),IPRM(*),IPOINT(*),ASLP(NDV,*),DG(*),XZRO(*),
     3GZRO(*),C(*),HM(*),GMULT(*),ALAMDA(*),P(*),GGL(*),GSAV(*),SCALG(1)
      ZRO=1.0E-10
      STOL=0.0001
      SMX=0.
      SCALG(1)=0.
      CT=RPRM(1)
      CTMIN=RPRM(2)
      DABSTR=RPRM(12)
      DELSTR=RPRM(13)
      NSCAL=IPRM(2)
      IWRITE=IPRM(5)
      IGMAX=IPRM(7)
      JTMAX=IPRM(8)
      ITRMST=IPRM(9)
      JPRINT=IPRM(10)
      JWRITE=IPRM(13)
      JSCAL=1
      OBJTRU=OBJ
      IF(IGOTO.EQ.1) GO TO 50
      IF(IGOTO.EQ.2) GO TO 160
      IF(IGOTO.EQ.3) GO TO 190
      IF(IGOTO.EQ.4) GO TO 220
      JTER=0
      IDEL=0
      IDAB=0
      IF(IPRINT.GT.1) WRITE (IWRITE,600)
      IF(JWRITE.GT.0) CALL DOT506(JTER,NDV,NCON,JWRITE,OBJ,X,SCALX,G)
      CALL DOT406 (NDV,HM)
      FACT=ABS(OBJ)/FLOAT(NDV)+.1
      IF(FACT.LT.0.1) FACT=0.1
      IF(FACT.GT.100.) FACT=100.
      DO 10 I=1,NCON
         ALAMDA(I)=0.
         GMULT(I)=FACT
10    CONTINUE
20    CONTINUE
      JTER=JTER+1
      IF (IPRINT.GT.1) WRITE (IWRITE,630) JTER
      IF(JTER.GT.1) THEN
         N1=NAVCQ
         DO 40 I=1,NDV
            XLSLP(I)=DF(I)
            IF(NGT.GT.0) THEN
               DO 30 J=1,NGT
                  K=IC(J)
                  XLSLP(I)=XLSLP(I)+A(I,J)*ALAMDA(K)
30             CONTINUE
            ENDIF
            IF(NACS.GT.0) THEN
               N2=ISIDC(I)
               IF(N2.LT.0.OR.N2.GT.1) THEN
                  N1=N1+1
                  XX=SCALX(I)*XL(I)-X(I)
                  IF(XX.GT.1.0E-3) XLSLP(I)=XLSLP(I)-C(N1)
               ENDIF
               IF(N2.GT.0) THEN
                  N1=N1+1
                  XX=X(I)-SCALX(I)*XU(I)
                  IF(XX.GT.1.0E-3) XLSLP(I)=XLSLP(I)+C(N1)
               ENDIF
            ENDIF
40          CONTINUE
      ENDIF
      CUT=-1.0E+5
      CALL DOT302(NCON,CUT,NGMAX,G,IC,NGT)
      IPRM(20)=NGT
      IGOTO=1
      INFO=2
      OBJ=OBJTRU
      RETURN
50    CONTINUE
      IF(IPRINT.GE.4) THEN
         ICALC=3
         JSCAL=1
         CALL DOT502(ICALC,DF,NDV,IWRITE,JSCAL,SCALX)
         IF (NCON.GT.0.AND.NGT.GT.0) THEN
            WRITE (IWRITE,670) NGT
            WRITE (IWRITE,680) (IC(I),I=1,NGT)
            JSCAL=-1
            DO 60 J=1,NGT
               JJ=IC(J)
               WRITE(IWRITE,420) JJ
               CALL DOT501(A(1,J),NDV,IWRITE,JSCAL,SCALX)
60          CONTINUE
         ENDIF
      ENDIF
      IF(JTER.GT.1.AND.ALPHA.LE.0.05) CALL DOT406(NDV,HM)
      IF(JTER.GT.1.AND.ALPHA.GT.0.05) THEN
      N1=NAVCQ
         DO 80 I=1,NDV
            P(I)=DF(I)
            DO 70 J=1,NGT
               K=IC(J)
               P(I)=P(I)+A(I,J)*ALAMDA(K)
70          CONTINUE
            IF(NACS.GT.0) THEN
               N2=ISIDC(I)
               IF(N2.LT.0.OR.N2.GT.1) THEN
                  N1=N1+1
                  XX=SCALX(I)*XL(I)-X(I)
                  IF(XX.GT.1.0E-3) P(I)=P(I)-C(N1)
               ENDIF
               IF(N2.GT.0) THEN
                  N1=N1+1
                  XX=X(I)-SCALX(I)*XU(I)
                  IF(XX.GT.1.0E-3) P(I)=P(I)+C(N1)
               ENDIF
            ENDIF
            P(I)=P(I)-XLSLP(I)
            XZRO(I)=X(I)-XZRO(I)
80       CONTINUE
         CALL DOT377 (NDV,P,XZRO,HM,S,ZRO,ILL)
         IF (ILL.NE.0.AND.IPRINT.GE.3) WRITE (IWRITE,580)
      ENDIF
         IF (IPRINT.GE.4) CALL DOT511(NDV,HM,IWRITE)
      OBJSAV=OBJ
      CALL DOT401 (NDV,X,XZRO)
      CALL DOT401 (NCON,G,GSAV)
      CTMIN=RPRM(2)
      DO 1001 I=1,NCON
         GI=G(I)
         GZRO(I)=GI
         IF(GI.LE.ZRO) GO TO 1001
         ABGI=ABS(GI)
         DO 1002 J=1,NCON
            IF(J.EQ.I) GO TO 1002
            GJ=G(J)
            GIGJ=GI*GJ
            DELTAG=ABS(GI+GJ)/(1.+ABGI)
            IF(DELTAG.LT.ZRO.AND.GIGJ.LT.0.) GO TO 1001
1002     CONTINUE
            GZRO(I)=GZRO(I)+MIN(GI,CTMIN)
1001  CONTINUE
      DO 90 I=1,NDV
         XLSLP(I)=XL(I)-X(I)/SCALX(I)
         XUSLP(I)=XU(I)-X(I)/SCALX(I)
90    CONTINUE
      DO 100 I=1,NCON
         GMULT(I)=.5*GMULT(I)
100   CONTINUE
      CALL DOT371 (NDV,NGT,X,A,DF,G,GZRO,ICSLP,XLSLP,XUSLP,WK,
     1IWK,IPOINT,IPRM,IPRINT,SCALX,NSCAL,MINMAX,RPRM,
     2CT,JPRINT,ASLP,NGMAX,NRB,ALAMDA,HM,P,NAVCQ,IC,C,NACS,NAVCR)
      IF(IPRM(18).GT.0) GO TO 230
      DO 110 I=1,NCON
         ALAMDA(I)=0.
110   CONTINUE
      FACTG=0.
      FACTL=1.
      IF(JTER.GT.1) THEN
         FACTG=1.
         FACTL=.5
      ENDIF
      DO 120 I=1,NAVCQ
         J=ICSLP(I)
         K=IC(J)
         ALAMDA(K)=C(I)
         GMULT(K)=FACTG*GMULT(K)+FACTL*ALAMDA(K)
         GMULT(K)=MAX(GMULT(K),ALAMDA(K))
120   CONTINUE
      CALL DOT401(NCON,GSAV,G)
      IF (IPRINT.GT.3) WRITE (IWRITE,650)
      ALPHA=1.
      SMX=0.
      DO 130 I=1,NDV
         SS=ABS(X(I))
         IF (SS.GE.SMX) SMX=SS
         S(I)=X(I)
         X(I)=XZRO(I)+ALPHA*S(I)
         IF(X(I).LT.SCALX(I)*XL(I)) X(I)=SCALX(I)*XL(I)
         IF(X(I).GT.SCALX(I)*XU(I)) X(I)=SCALX(I)*XU(I)
130   CONTINUE
      IF(SMX.LE.STOL.AND.IPRINT.GT.1) WRITE(IWRITE,560)
      IF (SMX.LE.STOL) GO TO 230
      ICALC=2
      JSCAL=1
      IF (IPRINT.GT.3) CALL DOT502 (ICALC,S,NDV,IWRITE,JSCAL,SCALX)
      CTMP=0.
      CALL DOT402(NCON,G,CTMP,GMAXZ,JGMAX)
      CALL DOT404(NDV,DF,S,SLOPF)
      DO 140 I=1,NCON
         DG(I)=0.
140   CONTINUE
      DO 150 J=1,NGT
         JJ=IC(J)
         CALL DOT404(NDV,A(1,J),S,DG(JJ))
150   CONTINUE
      OBJ=OBJSAV
      CALL DOT372(NCON,OBJ,G,GMULT,PHIZ)
      IGOTO=2
      INFO=1
      OBJ=OBJTRU
      RETURN
160   CONTINUE
      CTMP=0.
      CALL DOT402(NCON,G,CTMP,GMAX1,JGMAX)
      ALPBST=0.
      IF(GMAXZ.GT.RPRM(2).AND.GMAX1.LT.GMAXZ) ALPBST=ALPHA
      OBJ1=OBJ
      CALL DOT372(NCON,OBJ,G,GMULT,PHI1)
      XXL=0.
      FL=PHIZ
      XXU=ALPHA
      FU=PHI1
      ALP1=ALPHA
      ALPMAX=ALP1
      DELALP=0.00001
      DABALP=1.0E-6
      SLOPF2=((OBJ1-OBJSAV)/ALP1-SLOPF)/ALP1
      IGOTO=0
170   CONTINUE
      CALL DOT126(IGOTO,PHI,ALPHA,ALPMAX,DELALP,DABALP,XXL,
     *X1,X2,XXU,FL,F1,F2,FU,II,IX,NITER)
      OBJ=OBJSAV+SLOPF*ALPHA+SLOPF2*ALPHA*ALPHA
      CALL DOT373(NCON,OBJ,GZRO,G,DG,ALPHA,ALP1,GMULT,PHI)
      IF(IGOTO.GT.0) GO TO 170
      ICHK=0
      ALP2=ALPHA
      DALP=ABS(ALPHA-ALP1)
      IF(DALP.GT.0.1) THEN
         ICHK=1
         ALP2=0.8*ALP1
         IF(ALPHA.LT.ALP2) ALP2=0.8*ALP1
         IF(ALPHA.LT.0.6*ALP1) ALP2=.6*ALP1
         IF(ALPHA.LT.0.4*ALP1) ALP2=0.4*ALP1
         IF(ALPHA.LT.0.2*ALP1) ALP2=0.2*ALP1
         CALL DOT401(NCON,G,GGL)
      ENDIF
      DO 180 I=1,NDV
         X(I)=XZRO(I)+ALP2*S(I)
         IF(X(I).LT.SCALX(I)*XL(I)) X(I)=SCALX(I)*XL(I)
         IF(X(I).GT.SCALX(I)*XU(I)) X(I)=SCALX(I)*XU(I)
180   CONTINUE
      IGOTO=3
      INFO=1
      OBJ=OBJTRU
      RETURN
190   CONTINUE
      CTMP=0.
      CALL DOT402(NCON,G,CTMP,GMAX1,JGMAX)
      IF(GMAXZ.GT.RPRM(2).AND.GMAX1.LT.GMAXZ) ALPBST=ALP2
      IF(ICHK.GT.0) THEN
         OBJ2=OBJ
         XXL=0.
         FL=PHIZ
         XXU=ALP1
         FU=PHI1
         ALPMAX=ALP1
         DELALP=0.00001
         DABALP=1.0E-6
         SLOPF3=(OBJ2-OBJSAV)/((ALP2-ALP1)*ALP2**2)-
     *   (OBJ1-OBJSAV)/((ALP2-ALP1)*ALP1**2)+SLOPF/(ALP1*ALP2)
         SLOPF2=((OBJ1-OBJSAV)/ALP1-SLOPF)/ALP1-SLOPF3*ALP1
         A2=((OBJ-OBJSAV)/ALP2-(OBJ1-OBJSAV)/ALP1)/(ALP2-ALP1)
         A1=(OBJ1-OBJSAV)/ALP1-A2*ALP1
         IGOTO=0
200      CONTINUE
         CALL DOT126(IGOTO,PHI,ALPHA,ALPMAX,DELALP,DABALP,XXL,
     *   X1,X2,XXU,FL,F1,F2,FU,II,IX,NITER)
         OBJ=OBJSAV+SLOPF*ALPHA+SLOPF2*ALPHA**2+SLOPF3*ALPHA**3
         IF(ALP2.LT.0.3) OBJ=OBJSAV+A1*ALPHA+A2*ALPHA**2
         CALL DOT374(NCON,OBJ,GZRO,GGL,G,DG,ALPHA,ALP1,ALP2,GMULT,PHI)
         IF(IGOTO.GT.0) GO TO 200
         IF(GMAXZ.GT.RPRM(2).AND.ALPHA.LT.1.0E-5) ALPHA=ALPBST
         DO 210 I=1,NDV
            X(I)=XZRO(I)+ALPHA*S(I)
            IF(X(I).LT.SCALX(I)*XL(I)) X(I)=SCALX(I)*XL(I)
            IF(X(I).GT.SCALX(I)*XU(I)) X(I)=SCALX(I)*XU(I)
210      CONTINUE
         IGOTO=4
         INFO=1
         OBJ=OBJTRU
         RETURN
      ENDIF
220   CONTINUE
      CTMP=0.
      CALL DOT402 (NCON,G,CTMP,GMAX,JGMAX)
      IF (IPRINT.GT.3) WRITE(IWRITE,610)ALPHA
      OBJT=OBJ
      IF(MINMAX.GT.0) OBJT=-OBJ
      IF (IPRINT.GT.1) WRITE (IWRITE,620) OBJT
      ICALC=1
      JSCAL=1
      IF (IPRINT.GT.1) CALL DOT502 (ICALC,X,NDV,IWRITE,JSCAL,SCALX)
      ICALC=4
      JSCAL=0
      IF (IPRINT.GT.2) CALL DOT502 (ICALC,G,NCON,IWRITE,JSCAL,SCALG)
      IF (IPRINT.GT.2) WRITE (IWRITE,660) GMAX
      IF(JWRITE.GT.0) CALL DOT506(JTER,NDV,NCON,JWRITE,OBJ,X,SCALX,G)
      CALL DOT208 (OBJ,OBJSAV,DELSTR,DABSTR,IDEL,IDAB)
      IF(GMAX.GT.RPRM(2)) THEN
         IDEL=0
         IDAB=0
      ENDIF
      IF (ALPHA.LE.0.0) GO TO 230
      IF (JTER.GE.JTMAX) GO TO 230
      IF (IDEL.GE.ITRMST.OR.IDAB.GE.ITRMST) GO TO 230
      GO TO 20
230   CONTINUE
      CALL DOT203 (NDV,NCON,NGMAX,NGT,G,ITMP,CT,CTMIN,NAC,NVC,IGMAX)
      IF (IPRINT.EQ.0) GO TO 270
      WRITE (IWRITE,430) JTER
      CALL DOT212 (NDV,NACS,X,XL,XU,ISIDC,SCALX)
      WRITE (IWRITE,440) CT
      NAVC=NAC+NVC
      WRITE (IWRITE,510) NAC,NVC
      IF (NAVC.GT.0) WRITE (IWRITE,520)
      IF (NAVC.GT.0) WRITE (IWRITE,530) (ITMP(I),I=1,NAVC)
      WRITE (IWRITE,540) NACS
      IF (NACS.EQ.0) GO TO 260
      N=0
      DO 250 I=1,NDV
      IF (ISIDC(I).EQ.0) GO TO 250
      IF (ISIDC(I).EQ.1) GO TO 240
      N=N+1
      ITMP(N)=-I
240   IF (ISIDC(I).LT.0) GO TO 250
      N=N+1
      ITMP(N)=I
250   CONTINUE
      WRITE (IWRITE,550)
      WRITE (IWRITE,530) (ITMP(I),I=1,NACS)
260   WRITE (IWRITE,450)
      IF (JTER.GE.JTMAX) WRITE (IWRITE,460)
      IF (IDEL.GE.ITRMST) WRITE (IWRITE,470) ITRMST
      IF (IDAB.GE.ITRMST) WRITE (IWRITE,480) ITRMST
      IF (ALPHA.LE.0.0) WRITE (IWRITE,490)
      IF (SMX.LE.STOL) WRITE (IWRITE,500) SMX,STOL
      IF(NVC.GT.0) WRITE (IWRITE,590)
270   CONTINUE
      INFO=0
      IGOTO=0
      RETURN
420   FORMAT (/,2X,'GRADIENT OF CONSTRAINT NUMBER',I8)
430   FORMAT (////,2X,'-- OPTIMIZATION IS COMPLETE',//,2X,
     1'NUMBER OF CONSTRAINED MINIMIZATIONS =',I5)
440   FORMAT (/,2X,'CONSTRAINT TOLERANCE, CT =',1PE12.5)
450   FORMAT (/,2X,'TERMINATION CRITERIA')
460   FORMAT (/,2X,'NUMBER OF ITERATIONS = JTMAX')
470   FORMAT (/,2X,'RELATIVE CONVERGENCE CRITERION WAS MET FOR',I3,
     1' CONSECUTIVE ITERATIONS')
480   FORMAT (/,2X,'ABSOLUTE CONVERGENCE CRITERION WAS MET FOR',I3,
     1' CONSECUTIVE ITERATIONS')
490   FORMAT (/,2X,'UNABLE TO MAKE PROGRESS')
500   FORMAT (/,2X,'MAXIMUM S-VECTOR COMPONENT =',1PE12.5,
     1' IS LESS THAN',1PE12.5)
510   FORMAT (/,2X,'THERE ARE',I8,' ACTIVE CONSTRAINTS AND',I8,
     1' VIOLATED CONSTRAINTS')
520   FORMAT (2X,'CONSTRAINT NUMBERS')
530   FORMAT (2X,5I10)
540   FORMAT (/,2X,'THERE ARE',I8,' ACTIVE SIDE CONSTRAINTS')
550   FORMAT (2X,'VARIABLE NUMBERS (MINUS INDICATES LOWER BOUND)')
560   FORMAT (/,2X,'Q.P. SUB-PROBLEM GAVE NULL SEARCH DIRECTION.',
     *'  CONVERGENCE ASSUMED.')
580   FORMAT (/,2X,'REVISION OF HESSIAN FAILED')
590   FORMAT (/,2X,' * * * THE FINAL DESIGN VIOLATES CONSTRAINTS')
600   FORMAT (//,2X,'-- BEGIN CONSTRAINED OPTIMIZATION: SQP METHOD')
610   FORMAT (/,2X,'ALPHA =',1PE12.5)
620   FORMAT (/,2X,'OBJ =',1PE12.5)
630   FORMAT (//,2X,'-- BEGIN SQP ITERATION',I5)
650   FORMAT (/,2X,'Q.P. IS SOLVED')
660   FORMAT (/,2X,'GMAX =',1PE12.4)
670   FORMAT (/,2X,'RETAINED CONSTRAINTS (',I8,' )')
680   FORMAT (2X,7I10)
      END
      SUBROUTINE DOT371 (NDV,NCON,X,A,DF,G,GZRO,ICSLP,XLSLP,
     1XUSLP,WK,IWK,IPOINT,IPRM,IPRINT,SCALX,
     2NSCAL,MINMAX,RPRM,CT,JPRINT,ASLP,NGMAX,NRB,DQ,
     3HM,P,NAVCQ,IC,C,NACS,NAVCR)
C
C                 ***** (C) COPYRIGHT *****
C     ***** VANDERPLAATS RESEARCH & DEVELOPMENT, INC. *****
C         ***** ALL RIGHTS RESERVED, WORLDWIDE *****
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION A(NDV,*),DF(*),G(*),GZRO(*),ICSLP(*),
     1WK(*),IWK(*),XLSLP(*),XUSLP(*),X(*),IPOINT(*),IPRM(*),SCALX(*),
     2RPRM(*),ASLP(NDV,*),DQ(*),HM(*),P(*),IC(*),C(*)
      METHOD=1
      NGT=0
      CTSAV=RPRM(1)
      CTMSAV=RPRM(2)
      RPRM(2)=0.0005
      NXTMP1=IPOINT(3)
      NS=IPOINT(6)
      NB=IPOINT(8)
      NGTMP=IPOINT(9)
      NGL=IPOINT(10)
      NDG=IPOINT(14)
      NTHETA=IPOINT(16)
      NISIDC=IPOINT(32)
      NITMP=IPOINT(33)
      DO 5 I=1,NDV
         X(I)=0.
5     CONTINUE
      KGOTO=0
      INFO=0
      KPRINT=0
      IF(JPRINT.GT.0) KPRINT=IPRINT
40    CONTINUE
      CALL DOT405 (NDV,HM,X,P)
      CALL DOT404 (NDV,P,X,Q)
      CALL DOT404 (NDV,DF,X,R)
      QOBJ=R+0.5*Q
      DO 60 J=1,NCON
         K=IC(J)
         G(J)=GZRO(K)
         DO 50 I=1,NDV
            G(J)=G(J)+A(I,J)*X(I)
50       CONTINUE
60    CONTINUE
      IF (INFO.EQ.1) GO TO 80
      DO 70 I=1,NDV
         DQ(I)=DF(I)+P(I)
70    CONTINUE
      DO 71 J=1,NGT
         JJ=ICSLP(J)
         DO 71 I=1,NDV
            ASLP(I,J)=A(I,JJ)
71    CONTINUE
80    CONTINUE
      SAV1=RPRM(3)
      SAV2=RPRM(4)
      RPRM(3)=.001
      RPRM(4)=.001
      CALL DOT201 (KGOTO,INFO,NDV,NCON,NGT,NAC,NVC,KPRINT,QOBJ,X,
     *XLSLP,XUSLP,DQ,WK(NS),G,ICSLP,WK(NDG),WK(NTHETA),C,
     1IWK(NISIDC),WK(NXTMP1),WK(NGL),IWK(NITMP),ASLP,
     2WK(NB),NRB,WK,IWK,WK(NGTMP),RPRM,IPRM,IPOINT,MINMAX,SCALX,
     3NSCAL,ALPHA,ALPMAX,ALPSAV,DF2,PHI,GMX1,IDAB,
     4IDEL,ITER,KCOUNT,LGOTO,NACS,CT,METHOD,NGMAX,OBJ1,SLOPF,
     5SCALS,ICOUNT,NAVCR)
      RPRM(3)=SAV1
      RPRM(4)=SAV2
      IF (KGOTO.GT.0) GO TO 40
      CALL DOT405 (NDV,HM,X,P)
      CALL DOT404 (NDV,P,X,Q)
      CALL DOT404 (NDV,DF,X,R)
      QOBJ=R+0.5*Q
      DO 100 J=1,NCON
         K=IC(J)
         G(J)=GZRO(K)
         DO 90 I=1,NDV
            G(J)=G(J)+A(I,J)*X(I)
90       CONTINUE
100    CONTINUE
      CALL DOT405 (NDV,HM,X,P)
      DO 170 I=1,NDV
         DQ(I)=DF(I)+P(I)
170   CONTINUE
      CT=RPRM(1)
      RPRM(1)=CTSAV
      CTMIN=RPRM(2)
      NCALC=0
      CALL DOT203 (NDV,NCON,NGMAX,NGT,G,ICSLP,CT,CTMIN,NAC,
     *NVC,NCALC)
      NAVCQ=NAC+NVC
      IF(NAVCQ.GT.0) THEN
         DO 95 J=1,NAVCQ
            JJ=ICSLP(J)
         DO 95 I=1,NDV
            ASLP(I,J)=A(I,JJ)
95       CONTINUE
      ENDIF
      CALL DOT212 (NDV,NACS,X,XLSLP,XUSLP,IWK(NISIDC),SCALX)
      IF(NACS.EQ.0.AND.NAVCQ.EQ.0) GO TO 130
      N2=1
      CALL DOT206 (NDV,N2,DQ,NDV,WK(NGL))
      SCALF=WK(NGL)
      IF(NAVCQ.GT.0) CALL DOT206 (NDV,NAVCQ,ASLP,NDV,WK(NGL))
      DUM1=1.
      DUM2=1.
      DUM3=1.
      NDUM=0
      THTZ=0.
      CALL DOT209 (NDV,NAVCQ,NDUM,NACS,DUM1,DUM2,DUM3,WK(NGL),G,DQ,
     1ASLP,ICSLP,IWK(NISIDC),IWK(NITMP),WK(NB),NRB,SCALF,WK(NS),
     2WK(NTHETA),C,BETA,RSDMX,THTZ)
130   CONTINUE
      RPRM(2)=CTMSAV
      RETURN
      END
      SUBROUTINE DOT372(NCON,OBJ,G,GMULT,PHI)
C
C                 ***** (C) COPYRIGHT *****
C     ***** VANDERPLAATS RESEARCH & DEVELOPMENT, INC. *****
C         ***** ALL RIGHTS RESERVED, WORLDWIDE *****
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION G(*),GMULT(*)
      PHI=OBJ
      ZRO=0.0
      DO 10 I=1,NCON
         GG=MAX(ZRO,G(I))
         PHI=PHI+GG*GMULT(I)
10    CONTINUE
      RETURN
      END
      SUBROUTINE DOT373(NCON,OBJ,GGZ,GG1,DG,ALPHA,ALP1,GMULT,PHI)
C
C                 ***** (C) COPYRIGHT *****
C     ***** VANDERPLAATS RESEARCH & DEVELOPMENT, INC. *****
C         ***** ALL RIGHTS RESERVED, WORLDWIDE *****
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION GGZ(*),GG1(*),DG(*),GMULT(*)
      PHI=OBJ
      ZRO=0.0
      FACT=ALPHA/ALP1
      DO 10 I=1,NCON
         GZ=GGZ(I)
         G1=GG1(I)
         DGZ=DG(I)
         IF(ABS(DGZ).LT.1.0E-4) THEN
            GGG=GZ+(G1-GZ)*FACT
         ELSE
            A2=((G1-GZ)/ALP1-DGZ)
            GGG=GZ+(DGZ+A2*FACT)*ALPHA
         ENDIF
         GG=MAX(ZRO,GGG)
         PHI=PHI+GG*GMULT(I)
10    CONTINUE
      RETURN
      END
      SUBROUTINE DOT374(NCON,OBJ,GGZ,GG1,GG2,DG,ALPHA,ALP1,ALP2,
     *GMULT,PHI)
C
C                 ***** (C) COPYRIGHT *****
C     ***** VANDERPLAATS RESEARCH & DEVELOPMENT, INC. *****
C         ***** ALL RIGHTS RESERVED, WORLDWIDE *****
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION GGZ(*),GG1(*),GG2(*),DG(*),GMULT(*)
      PHI=OBJ
      ZRO=0.0
      DO 10 I=1,NCON
         GZ=GGZ(I)
         G1=GG1(I)
         G2=GG2(I)
         DGZ=DG(I)
         IF(ABS(DGZ).LT.1.0E-4) THEN
            A2=((G2-GZ)/ALP2-(G1-GZ)/ALP1)/(ALP2-ALP1)
            A1=(G1-GZ)/ALP1-A2*ALP1
            GGG=GZ+A1*ALPHA+A2*ALPHA**2
         ELSE
            A3=(G2-GZ)/((ALP2-ALP1)*ALP2**2)-
     *      (G1-GZ)/((ALP2-ALP1)*ALP1**2)+DGZ/(ALP1*ALP2)
            A2=((G1-GZ)/ALP1-DGZ)/ALP1-A3*ALP1
            GGG=GZ+DGZ*ALPHA+A2*ALPHA**2+A3*ALPHA**3
         ENDIF
         IF(ALP2.LT.0.3.AND.DGZ.GT.1.0E-4) THEN
            A2=((G2-GZ)/ALP2-DGZ)/ALP2
            GGG=GZ+DGZ*ALPHA+A2*ALPHA**2
         ENDIF
         IF(ALP2.LT.0.3.AND.DGZ.GE.1.0E-4) THEN
            A2=((G2-GZ)/ALP2-(G1-GZ)/ALP1)/(ALP2-ALP1)
            A1=(G1-GZ)/ALP1-A2*ALP1
            GGG=GZ+A1*ALPHA+A2*ALPHA**2
         ENDIF
         PHI=PHI+MAX(ZRO,GGG)*GMULT(I)
10    CONTINUE
      RETURN
      END
      SUBROUTINE DOT377 (NDV,Y,P,B,S,ZRO,ILL)
C
C                 ***** (C) COPYRIGHT *****
C     ***** VANDERPLAATS RESEARCH & DEVELOPMENT, INC. *****
C         ***** ALL RIGHTS RESERVED, WORLDWIDE *****
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION P(*),Y(*),B(*),S(*)
      CALL DOT405 (NDV,B,P,S)
      CALL DOT404 (NDV,P,S,PBP)
      CALL DOT404 (NDV,P,Y,PY)
      PBP2=0.2*PBP
      THETA=1.
      IF (PY.LT.PBP2) THEN
         THETA=0.8*PBP/(PBP-PY)
         THETA1=1.-THETA
         DO 10 I=1,NDV
            Y(I)=THETA*Y(I)+THETA1*S(I)
10       CONTINUE
      ENDIF
      ILL=1
      CALL DOT404 (NDV,Y,P,SIGMA)
      SH=ABS(SIGMA)
      ST=ABS(PBP)
      IF (SH.LT.ZRO.OR.ST.LT.ZRO) RETURN
      SIGMA=1./SIGMA
      PBP=1./PBP
      NA=0
      DO 20 J=1,NDV
         DO 20 I=1,J
            NA=NA+1
            B(NA)=B(NA)+SIGMA*Y(I)*Y(J)-PBP*S(I)*S(J)
20    CONTINUE
      ILL=0
      RETURN
      END
